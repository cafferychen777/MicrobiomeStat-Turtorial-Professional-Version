# General FAQs

#### Q: I'm having an issue converting a phyloseq object to a MicrobiomeStat object using the `mStat_convert_phyloseq_to_data_obj()` function. Despite installing the latest version of MicrobiomeStat from GitHub, I'm still getting the error "could not find function 'mStat\_convert\_phyloseq\_to\_data\_obj'". Any suggestions?

**A:** It appears that there may have been an issue with the installation of the latest version of MicrobiomeStat. Please ensure that you have installed all the necessary dependencies before attempting to install MicrobiomeStat from GitHub. You can do this by running the following code:

```r
packages_to_install <- c(
  "rlang", "tibble", "ggplot2", "matrixStats", "lmerTest", "foreach",
  "modeest", "dplyr", "pheatmap", "tidyr", "ggh4x", "GUniFrac", "stringr",
  "rmarkdown", "knitr", "pander", "tinytex", "vegan", "scales", "ape",
  "ggrepel", "parallel", "ggprism", "aplot", "philentropy", "forcats",
  "yaml", "biomformat", "Biostrings"
)
install.packages(packages_to_install)
```

After installing these packages, try running `devtools::install_github("cafferychen777/MicrobiomeStat")` again to install the latest version of MicrobiomeStat from GitHub.

If you continue to experience issues, please check if there were any error messages during the installation process and share those error messages for further troubleshooting.

#### Q: I have used MicrobiomeStat for a longitudinal study and successfully plotted the Bray-Curtis distance over time using `generate_beta_ordination_pair`. However, I cannot access the Bray-Curtis distance data calculated by MicrobiomeStat. Will this option be included in the future?

**A:** The Bray-Curtis distances calculated by MicrobiomeStat are indeed accessible when you use the `generate_beta_ordination_pair` function. The distances are stored in the object generated by the function. For example, if you have used the following code:

```r
plot <- generate_beta_ordination_pair(
  data.obj = your_data_object,
  ...
)
```

You can access the Bray-Curtis data using:

```r
bray_curtis_data <- plot$BC$data
```

This will contain the Bray-Curtis distances calculated by the package. If you are following a similar procedure and still cannot access the data, please provide more details about the error or the issue you are encountering.

Regarding your question about future updates, we continuously strive to improve MicrobiomeStat and appreciate any suggestions for new features or enhancements.

#### Q: I confused two methods, `generate_beta_ordination_pair` and `generate_beta_change_spaghettiplot_long`. I can get the data with the former but not with the latter. Is the BC distance in `generate_beta_ordination_pair` equivalent to `generate_beta_change_spaghettiplot_long` if `dist.name = c("BC")` is included?

**A:** The two methods, `generate_beta_ordination_pair` and `generate_beta_change_spaghettiplot_long`, are not the same. The ordination method uses PC1 and PC2 from multidimensional scaling (MDS), whereas the `change_spaghettiplot` calculates distances relative to the original points.

To obtain the Bray-Curtis (BC) distance from the `generate_beta_change_spaghettiplot_long` method, you can use the following code:

```r
a <- generate_beta_change_spaghettiplot_long(
  data.obj = your_data_object,
  dist.name = c("BC"),
  ...
)
a$BC$layers[[1]]$data
```

This code will provide you with the BC distances for each subject and time point, along with other relevant variables.

#### Q: While running the tutorial, I encountered an error with `generate_beta_test_single()`: `Error in colnames<-(*tmp*, value = colnames(lhs)) : attempt to set 'colnames' on an object with less than two dimensions`. Do you have any idea what's happening here?

**A:** Thank you for reaching out with your issue. It's possible that there might be some conflicts or issues specific to your setup or environment. As a troubleshooting step, I recommend trying the following:

1. Reinstall the MicrobiomeStat package. It's possible that there might have been some issues during your initial installation.
2. Additionally, consider reinstalling the GUniFrac package, as it might play a role in the function you're working with.
3. Please ensure that you have the latest versions of all the required dependencies and packages.

If after these steps you continue to face the issue, please provide more details about your system setup and any error messages you're receiving, so I can assist you further.

#### Q: I am encountering an issue with the `generate_alpha_trend_test_long` function in the MicrobiomeStat package. When I run the function, I receive the error: `Error in vec_data() : ! 'x' must be a vector, not a <sample_data> object`. The time variable in my dataset is numeric. Do you understand the problem?

**A:** Thank you for reaching out with your issue. It seems that the `feature.tab`, `meta.dat`, and `feature.ann` components of your data object may not be in the expected format of base R matrices or data frames. To address this issue, please try converting these components to the correct format using the following code:

```r
ms_rare$feature.tab <- as.data.frame(ms_rare$feature.tab) %>%
  as.matrix()

ms_rare$meta.dat <- as.matrix(ms_rare$meta.dat) %>%
  as.data.frame()

ms_rare$feature.ann <- ms_rare$feature.ann %>%
  as.data.frame() %>%
  as.matrix()
```

By following these steps, you should be able to ensure that your data components are in the expected format for the MicrobiomeStat package. If you continue to face problems or have further questions, please don't hesitate to reach out.

#### Q: When I try to normalize the data using the GMPR method in the MicrobiomeStat package, I get an error that says `Error in GMPR(otu_tab) : could not find function "GMPR"`. How can I resolve this issue?

**A:** The error you're encountering typically occurs when the required package for the GMPR function is not loaded. To resolve this issue, you should load the GUniFrac package before attempting to normalize your data with the GMPR method. You can do this by using the `library()` function in R:

```r
library(GUniFrac)
```

After executing this line, you should be able to normalize your MicrobiomeData using the GMPR method without encountering the error.

#### Q: I am trying to visualize the change in taxas across multiple timepoints using `generate_taxa_areaplot_long`. However, in the visualization, I am missing some timepoints listed in `ts.levels` and some `subject.var`. My initial timepoint is "0", and the following timepoints are "1", "2", "3", "5", "6", "7", "8", "10", "12", "18", "24". Not all timepoints are present in all samples, which I think is where the problem lies. Do you have any suggestions?

**A:** Thank you for reaching out with your issue. To address the problem with missing timepoints and subject variables in your visualization, you can try pairing `mStat_subset_data` with `generate_taxa_areaplot_long` in a loop to iteratively generate a barplot for each individual. This approach could provide a more detailed visualization for each subject and might help in addressing the challenges you've been facing. Here's a simple example for you to refer to:

```r
# Loading the data
data(subset_T2D.obj)

# Extracting unique subject IDs
unique.subject.id <- subset_T2D.obj$meta.dat$subject_id

# Looping over each subject ID
plot.list <- lapply(unique.subject.id, function(subject.id){
  
  # Identifying sample IDs for the current subject
  sample.ids <- rownames(subset_T2D.obj$meta.dat[subset_T2D.obj$meta.dat$subject_id == subject.id, ])
  
  # Subsetting data for the current subject
  sub_subset_T2D.obj <- mStat_subset_data(subset_T2D.obj, sample.ids)
  
  # Generating taxa area plot for the current subset
  generate_taxa_areaplot_long(sub_subset_T2D.obj,
                              subject.var = "subject_id",
                              time.var = "visit_number_num",
                              feature.level = c("Genus"),
                              feature.dat.type = "count",
                              file.ann = subject.id)
})
```

In this example, `group.var` is set to `NULL`. Depending on your specific analysis needs, you might want to modify this. If you're looking to group your data by a specific variable, you should replace `NULL` with the name of that variable in the `group.var` parameter. This will allow you to analyze and visualize your data based on the groups defined by this variable.

#### Q: I see that the `linda()` function in MicrobiomeStat already takes into account FDR, but in the `generate_taxa_volcano_single()` function there is an option called `feature.mt.method` that can be set to "none" or "fdr". What is the reason for adding another FDR layer on top of the LinDa calculation?

**A:** Thank you for reaching out with your question. Indeed, for high-dimensional data, incorporating FDR adjustment is essential to control for multiple testing issues. The `linda()` function inherently conducts FDR adjustments, which is reflected in both the raw p-values and the adjusted p-values.

The `feature.mt.method` parameter in the `generate_taxa_volcano_single()` function is designed to provide users with the option to choose between using adjusted p-values (via FDR correction) or raw p-values for visualization in the volcano plot. Opting for raw p-values in visualization is primarily for aesthetic reasons, ensuring the clarity and interpretability of the plot.

In summary, while FDR adjustment is integral to the statistical procedures performed by MicrobiomeStat, the `feature.mt.method` parameter offers flexibility in visualization choices without compromising the underlying statistical rigor.
