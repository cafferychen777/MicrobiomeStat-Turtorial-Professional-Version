---
description: >-
  Unveil microbial diversity in your data with MicrobiomeStat's taxa analysis
  tools. Investigate how taxa abundance varies across groups and time points.
---

# Cross-Sectional Investigation: Taxa Analysis with MicrobiomeStat

Before visualizing taxa abundance, we conduct differential abundance testing using `generate_taxa_test_single` to pinpoint taxa with significant differences between groups.

```r
data(peerj32.obj)
test.list <- generate_taxa_test_single(
    data.obj = peerj32.obj,
    time.var = "time",
    t.level = "2",
    group.var = "group",
    adj.vars = "sex",
    feature.dat.type = "count",
    feature.level = c("Phylum","Genus","Family"),
    prev.filter = 0.1,
    abund.filter = 0.0001,
    feature.sig.level = 0.1,
    feature.mt.method = "none"
)
volcano_plots <- generate_taxa_volcano_single(data.obj = peerj32.obj,
                                              group.var = "group",
                                              test.list = test.list,
                                              feature.sig.level = 0.1,
                                              feature.mt.method = "none")
volcano_plots
```

<figure><img src="../.gitbook/assets/Screenshot 2023-10-07 at 15.18.08.png" alt=""><figcaption></figcaption></figure>

Using the `volcano_plots` from the code, we produce a volcano plot. This plot visualizes the relationship between the magnitude of change (x-axis) and its statistical significance (y-axis), aiding researchers in identifying significant differences in taxa abundance.

This function applies preprocessing like filtering, normalization and aggregation at the specified taxonomic level. Then it runs the LinDA method to test for significant differences between groups, adjusting for covariates.

The results contain tables summarizing significant taxa, their abundance statistics, and associated p-values and effect sizes. This guides selection of interesting taxa for further investigation.

#### Differential abundance results at Genus level

| Variable                          | Coefficient | SE        | P.Value    | Adjusted.P.Value | Mean.Abundance | Prevalence |
| --------------------------------- | ----------- | --------- | ---------- | ---------------- | -------------- | ---------- |
| Actinomycetaceae                  | 0.43088737  | 0.8125191 | 0.60204023 | 0.9892442        | 0.0001950405   | 0.7272727  |
| Aerococcus                        | -0.09734179 | 0.7893169 | 0.90314569 | 0.9892442        | 0.0002352668   | 0.5909091  |
| Aeromonas                         | 0.02022775  | 1.0311377 | 0.98455351 | 0.9892442        | 0.0002829477   | 0.6363636  |
| Akkermansia                       | -0.70914707 | 0.5667601 | 0.22603834 | 0.9892442        | 0.0202212889   | 1.0000000  |
| Allistipes et rel.                | -0.54628088 | 0.4985462 | 0.28688461 | 0.9892442        | 0.0083365762   | 1.0000000  |
| Anaerofustis                      | 0.37736758  | 0.3988262 | 0.35592789 | 0.9892442        | 0.0013725489   | 1.0000000  |
| Anaerostipes caccae et rel.       | -0.45297144 | 0.1723513 | 0.01655715 | 0.7004574        | 0.0185944926   | 1.0000000  |
| Anaerotruncus colihominis et rel. | 0.05420558  | 0.4605402 | 0.90754073 | 0.9892442        | 0.0028354658   | 1.0000000  |
| Anaerovorax odorimutans et rel.   | -0.55577241 | 0.3180729 | 0.09672749 | 0.9892442        | 0.0044828621   | 1.0000000  |
| Aneurinibacillus                  | -0.20493605 | 0.5227462 | 0.69939327 | 0.9892442        | 0.0007296989   | 0.9545455  |

Before visualizing abundance distribution using heatmaps, we can also generate exploratory plots like boxplots to compare taxa abundance between groups.

MicrobiomeStat provides two options:

`generate_taxa_boxplot_single` generates a single faceted plot with all taxa:

```r
generate_taxa_boxplot_single(
  data.obj = peerj32.obj,
  subject.var = "subject",
  time.var = "time",
  t.level = "1",
  group.var = "group",
  strata.var = NULL,
  feature.level = c("Family"),
  feature.dat.type = "count",
  features.plot = NULL,
  top.k.plot = NULL,
  top.k.func = NULL,
  Transform = "log",
  prev.filter = 0,
  abund.filter = 0,
  base.size = 16,
  theme.choice = "bw",
  custom.theme = NULL,
  palette = NULL,
  pdf = TRUE,
  file.ann = NULL,
  pdf.wid = 11,
  pdf.hei = 8.5
)
```

<figure><img src="../.gitbook/assets/Screenshot 2023-08-05 at 19.58.13.png" alt=""><figcaption><p>This boxplot, generated by MicrobiomeStat's <code>generate_taxa_boxplot_single</code> function, visually showcases the distribution of microbial genus abundance between LGG and placebo groups at time point 1. The white lines represent the median abundance, while the violin shapes showcase the abundance distribution. Genera like Akkermansia and Parabacteroides exhibit lower abundance among LGG samples compared to placebo. This plot swiftly highlights patterns of differential abundance between groups, priming us for subsequent in-depth analysis.</p></figcaption></figure>

`generate_taxa_indiv_boxplot_single` generates separate plots per taxon:

```r
generate_taxa_indiv_boxplot_single(
  data.obj = peerj32.obj,
  subject.var = "subject",
  time.var = "time",
  t.level = "1",
  group.var = "group",
  strata.var = "sex",
  feature.level = c("Family"),
  features.plot = NULL,
  feature.dat.type = "count",
  top.k.plot = NULL,
  top.k.func = NULL,
  Transform = "log",
  prev.filter = 0,
  abund.filter = 0,
  base.size = 20,
  theme.choice = "bw",
  custom.theme = NULL,
  palette = NULL,
  pdf = TRUE,
  file.ann = NULL,
  pdf.wid = 11,
  pdf.hei = 8.5
)
```

<figure><img src="../.gitbook/assets/Screenshot 2023-08-05 at 20.04.16.png" alt=""><figcaption><p>These individual boxplots, produced by MicrobiomeStat's <code>generate_taxa_indiv_boxplot_single</code> function, offer a nuanced view of microbial family abundance distribution across subjects, faceted by sex. The x-axis represents subjects grouped by LGG/placebo, and y-axis shows log-transformed abundance. Differing abundance ranges and distribution shapes are observed between taxa like Ruminococcaceae and Lachnospiraceae. Such customized inspection uncovers fine-grained sample-level variations, setting the stage for subsequent integration of patterns.</p></figcaption></figure>

The two functions provide complementary visualization before aggregating data in heatmaps.Next, we can visualize the abundance using `generate_taxa_heatmap_single`: Let's start by omitting time factors and stratification variables:

```r
generate_taxa_heatmap_single(
  data.obj = peerj32.obj,
  subject.var = "subject",
  time.var = NULL,
  t.level = NULL,
  group.var = "group",
  strata.var = NULL,
  feature.level = c("Family"),
  feature.dat.type = "count",
  features.plot = NULL,
  top.k.plot = NULL,
  top.k.func = NULL,
  prev.filter = 0.1,
  abund.filter = 0.1,
  base.size = 10,
  palette = NULL,
  pdf = TRUE,
  file.ann = "test",
  pdf.wid = 11,
  pdf.hei = 8.5
)
```

<figure><img src="../.gitbook/assets/Screenshot 2023-06-11 at 20.39.58.png" alt=""><figcaption><p>This heatmap, generated by MicrobiomeStat's <code>generate_taxa_heatmap_single</code> function, vividly showcases the abundance of microbial families across our groups of interest. The color-coding allows for swift detection of abundance patterns, setting the stage for an in-depth comparative analysis.</p></figcaption></figure>

By carefully examining the clusters within our heatmap üîç, we can identify **families of microbes that display similar patterns of abundance** üìä. Furthermore, setting `cluster.cols = TRUE` allows us to pinpoint samples with analogous abundance profiles.

Continuing on our exploratory quest, we turn to dot plots with MicrobiomeStat's `generate_taxa_dotplot_single` function. This function enables us to compare the average abundance and prevalence of each taxa across different groups.

Let's generate a dot plot without considering any time or stratification variables:

```r
generate_taxa_dotplot_single(
  data.obj = peerj32.obj,
  subject.var = "subject",
  time.var = NULL,
  t0.level = NULL,
  group.var = "group",
  strata.var = NULL,
  feature.level = c("Family"),
  feature.dat.type = "count",
  features.plot = NULL,
  top.k.plot = NULL,
  top.k.func = NULL,
  prev.filter = 0.1,
  abund.filter = 0.1,
  base.size = 16,
  theme.choice = "bw",
  custom.theme = NULL,
  palette = NULL,
  pdf = TRUE,
  file.ann = NULL,
  pdf.wid = 15,
  pdf.hei = 8.5
)
```

<figure><img src="../.gitbook/assets/Screenshot 2023-06-11 at 20.44.18.png" alt=""><figcaption><p>With the help of the <code>generate_taxa_dotplot_single</code> function, this dot plot presents a clear comparison of the average abundance and prevalence of each microbial family across our groups. The graphical representation makes it easier to spot potential differences in microbial presence and abundance across different groups.</p></figcaption></figure>

Through this plot, we're able to discern **whether there are significant differences in the average abundance and prevalence of each taxa between our groups**.

Finally, we'll utilize stacked bar plots with the `generate_taxa_barplot_single` function to investigate if there's a **difference in species composition across different groups**:

```r
generate_taxa_barplot_single(
  data.obj = peerj32.obj,
  subject.var = "subject",
  time.var = NULL,
  t.level = NULL,
  group.var = "group",
  strata.var = NULL,
  feature.level = "Family",
  feature.dat.type = "count",
  feature.number = 30,
  base.size = 10,
  theme.choice = "bw",
  custom.theme = NULL,
  palette = NULL,
  pdf = TRUE,
  file.ann = NULL,
  pdf.wid = 11,
  pdf.hei = 8.5
)
```

<figure><img src="../.gitbook/assets/Screenshot 2023-06-11 at 20.57.06.png" alt=""><figcaption><p>This stacked bar plot, produced by the <code>generate_taxa_barplot_single</code> function, provides a detailed overview of individual species composition in our groups. By layering the information, we're able to see the distinct microbial composition of each subject, allowing us to appreciate the individual variability in the microbiome.</p></figcaption></figure>

<figure><img src="../.gitbook/assets/Screenshot 2023-06-11 at 20.57.37.png" alt=""><figcaption><p>Leveraging the same <code>generate_taxa_barplot_single</code> function, this stacked bar plot reveals the average species composition across our groups. The layers illustrate the overall microbial balance, offering a birds-eye view on group-level differences in microbiome structure.</p></figcaption></figure>

This code generates two types of stacked bar plots: individual and average. These charts offer a **double-perspective on the differences** between the two groups.

Remember, all of the above can be tailored to focus on a specific time point by setting `time.var` and `t.level`. Additionally, stratification variables can also be introduced to further segment our data and yield nuanced insights.
