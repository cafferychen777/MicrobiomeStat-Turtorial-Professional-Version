---
description: >-
  Unveil microbial diversity in your data with MicrobiomeStat's taxa analysis
  tools. Investigate how taxa abundance varies across groups and time points.
---

# Cross-Sectional Investigation: Taxa Analysis with MicrobiomeStat

Embarking on a journey through the microbial landscape, we first use MicrobiomeStat's `generate_taxa_heatmap_single` function. This function paints a rich, color-coded picture of microbial abundance across our groups of interest.

Before visualizing taxa abundance, we can perform differential abundance testing using `generate_taxa_test_single` to identify taxa that differ significantly between groups.

```r
taxa_results <- generate_taxa_test_single(
  data.obj = peerj32.obj,
  time.var = "time",
  t.level = "1",
  group.var = "group",
  adj_vars = "sex",
  feature.level = "Genus",
  ...
)
```

This function applies preprocessing like filtering, normalization and aggregation at the specified taxonomic level. Then it runs the ZicoSeq method to test for significant differences between groups, adjusting for covariates.

The results contain tables summarizing significant taxa, their abundance statistics, and associated p-values and effect sizes. This guides selection of interesting taxa for further investigation.

#### Differential abundance results at Genus level

| Variable                             | Group   | R.Squared | F.Statistic | Estimate | P.Value | Adjusted.P.Value | Mean.Proportion |
| ------------------------------------ | ------- | --------- | ----------- | -------- | ------- | ---------------- | --------------- |
| Actinomycetaceae                     | Placebo | 0.024     | 0.815       | -0.00387 | 0.45    | 0.963            | 0.000172        |
| Actinomycetaceae                     | LGG     | 0.024     | 0.815       | -0.00387 | 0.45    | 0.963            | 0.000100        |
| Aerococcus                           | Placebo | 0.011     | 0.515       | -0.0032  | 0.45    | 0.963            | 0.000168        |
| Aerococcus                           | LGG     | 0.011     | 0.515       | -0.0032  | 0.45    | 0.963            | 0.000312        |
| Aeromonas                            | Placebo | 0.00426   | 0.171       | -0.002   | 0.75    | 0.963            | 0.000178        |
| Aeromonas                            | LGG     | 0.00426   | 0.171       | -0.002   | 0.75    | 0.963            | 0.000336        |
| Akkermansia                          | Placebo | 0.00394   | 0.463       | -0.0182  | 0.36    | 0.963            | 0.0234          |
| Akkermansia                          | LGG     | 0.00394   | 0.463       | -0.0182  | 0.36    | 0.963            | 0.0127          |
| Alcaligenes faecalis subsp. faecalis | Placebo | 0.0399    | 0.987       | -0.0025  | 0.41    | 0.963            | 0.0000572       |
| Alcaligenes faecalis subsp. faecalis | LGG     | 0.0399    | 0.987       | -0.0025  | 0.41    | 0.963            | 0               |

This table shows the top 10 differentially abundant genera between groups based on ZicoSeq results, with statistics like R squared, F statistic, p-values, effect size and mean proportions. Additional columns for prevalence and abundance variation are omitted for brevity.

Next, we can visualize the abundance using `generate_taxa_heatmap_single`:

Let's start by omitting time factors and stratification variables:

```r
generate_taxa_heatmap_single(
  data.obj = peerj32.obj,
  subject.var = "subject",
  time.var = NULL,
  t.level = NULL,
  group.var = "group",
  strata.var = NULL,
  feature.level = c("Family"),
  feature.dat.type = "count",
  features.plot = NULL,
  top.k.plot = NULL,
  top.k.func = NULL,
  prev.filter = 0.1,
  abund.filter = 0.1,
  base.size = 10,
  palette = NULL,
  pdf = TRUE,
  file.ann = "test",
  pdf.wid = 11,
  pdf.hei = 8.5
)
```

<figure><img src="../.gitbook/assets/Screenshot 2023-06-11 at 20.39.58.png" alt=""><figcaption><p>This heatmap, generated by MicrobiomeStat's <code>generate_taxa_heatmap_single</code> function, vividly showcases the abundance of microbial families across our groups of interest. The color-coding allows for swift detection of abundance patterns, setting the stage for an in-depth comparative analysis.</p></figcaption></figure>

By carefully examining the clusters within our heatmap üîç, we can identify **families of microbes that display similar patterns of abundance** üìä. Furthermore, setting `cluster.cols = TRUE` allows us to pinpoint samples with analogous abundance profiles.

Continuing on our exploratory quest, we turn to dot plots with MicrobiomeStat's `generate_taxa_dotplot_single` function. This function enables us to compare the average abundance and prevalence of each taxa across different groups.

Let's generate a dot plot without considering any time or stratification variables:

```r
generate_taxa_dotplot_single(
  data.obj = peerj32.obj,
  subject.var = "subject",
  time.var = NULL,
  t0.level = NULL,
  group.var = "group",
  strata.var = NULL,
  feature.level = c("Family"),
  feature.dat.type = "count",
  features.plot = NULL,
  top.k.plot = NULL,
  top.k.func = NULL,
  prev.filter = 0.1,
  abund.filter = 0.1,
  base.size = 16,
  theme.choice = "bw",
  custom.theme = NULL,
  palette = NULL,
  pdf = TRUE,
  file.ann = NULL,
  pdf.wid = 15,
  pdf.hei = 8.5
)
```

<figure><img src="../.gitbook/assets/Screenshot 2023-06-11 at 20.44.18.png" alt=""><figcaption><p>With the help of the <code>generate_taxa_dotplot_single</code> function, this dot plot presents a clear comparison of the average abundance and prevalence of each microbial family across our groups. The graphical representation makes it easier to spot potential differences in microbial presence and abundance across different groups.</p></figcaption></figure>

Through this plot, we're able to discern **whether there are significant differences in the average abundance and prevalence of each taxa between our groups**.

Finally, we'll utilize stacked bar plots with the `generate_taxa_barplot_single` function to investigate if there's a **difference in species composition across different groups**:

```r
generate_taxa_barplot_single(
  data.obj = peerj32.obj,
  subject.var = "subject",
  time.var = NULL,
  t.level = NULL,
  group.var = "group",
  strata.var = NULL,
  feature.level = "Family",
  feature.dat.type = "count",
  feature.number = 30,
  base.size = 10,
  theme.choice = "bw",
  custom.theme = NULL,
  palette = c(ggsci::pal_nejm()(8),ggsci::pal_npg()(9),ggsci::pal_jama()(7),ggsci::pal_lancet()(9)),
  pdf = TRUE,
  file.ann = NULL,
  pdf.wid = 11,
  pdf.hei = 8.5
)
```

<figure><img src="../.gitbook/assets/Screenshot 2023-06-11 at 20.57.06.png" alt=""><figcaption><p>This stacked bar plot, produced by the <code>generate_taxa_barplot_single</code> function, provides a detailed overview of individual species composition in our groups. By layering the information, we're able to see the distinct microbial composition of each subject, allowing us to appreciate the individual variability in the microbiome.</p></figcaption></figure>

<figure><img src="../.gitbook/assets/Screenshot 2023-06-11 at 20.57.37.png" alt=""><figcaption><p>Leveraging the same <code>generate_taxa_barplot_single</code> function, this stacked bar plot reveals the average species composition across our groups. The layers illustrate the overall microbial balance, offering a birds-eye view on group-level differences in microbiome structure.</p></figcaption></figure>

This code generates two types of stacked bar plots: individual and average. These charts offer a **double-perspective on the differences** between the two groups.

Remember, all of the above can be tailored to focus on a specific time point by setting `time.var` and `t.level`. Additionally, stratification variables can also be introduced to further segment our data and yield nuanced insights.
