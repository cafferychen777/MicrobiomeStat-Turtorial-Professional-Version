---
description: >-
  Diving into alpha diversity analysis for longitudinal studies. How does
  within-sample diversity change over time? This page provides the tools to
  answer this question.
---

# Chronological Journey: Alpha Diversity Analysis in Longitudinal Studies

My apologies for the oversight. Let's insert the code for calculating alpha diversity in the correct place. Here's how the updated content would look:

Our expedition into **Chronological Journey: Alpha Diversity Analysis in Longitudinal Studies** launches with the indispensable task of loading our _critical dataset_ and meticulously **filtering out samples with low sequencing depth**. The star of this journey is none other than **alpha diversity analysis**, a potent method celebrated for unraveling the captivating complexities of **species diversity within each sample**. However, beware! This analytical star is highly **sensitive to sequencing depth**, its notorious adversary. In particular, samples with **extremely low sequencing depth** (for instance, those deceitful ones below 10) can throw our understanding of **microbial diversity** into disarray, weaving distorted narratives and infusing our analysis with treacherous bias. To fend off these destructive forces, we utilize our filtering arsenal with utmost precision, ensuring they meet their well-deserved exit.&#x20;

```r
# Import the library and load the dataset
library("HMP2Data")
T2D <- T2D16S()

# Convert the phyloseq object to a data object that MicrobiomeStat can work with
T2D.obj <- mStat_convert_phyloseq_to_data_obj(T2D.phy)

# Filter out samples with low sequencing depth (<2000)
subset_T2D.obj <- mStat_subset_data(T2D.obj, colnames(T2D.obj$feature.tab[, colSums(T2D.obj$feature.tab) >= 2000]))
```

Once we've prepared our dataset, we move on to calculate the alpha diversity, using Shannon diversity as our metric:

```r
# Calculate alpha diversity
T2D.alpha.obj <- mStat_calculate_alpha_diversity(subset_T2D.obj$feature.tab, "shannon")
```

Now that we have our alpha diversity data, we can visualize the results. We'll use a spaghetti plot to show how the alpha diversity changes over time for each individual in the study, grouped by race:

```r
# Generate a spaghetti plot of alpha diversity over time
generate_alpha_spaghettiplot_long(
  data.obj = subset_T2D.obj,
  alpha.obj = T2D.alpha.obj,
  alpha.name = c("shannon"),
  subject.var = "subject_id",
  time.var = "visit_number",
  t0.level = sort(unique(T2D.obj$meta.dat$visit_number))[1],
  ts.levels = sort(unique(T2D.obj$meta.dat$visit_number))[-1],
  group.var = "subject_race",
  strata.var = NULL,
  theme.choice = "bw",
  palette = ggsci::pal_npg()(9),
  pdf = TRUE,
  file.ann = NULL,
  pdf.wid = 11,
  pdf.hei = 8.5
)
```

<figure><img src="../.gitbook/assets/Screenshot 2023-06-13 at 21.18.16.png" alt=""><figcaption><p>Alpha Diversity Over Time Spaghetti Plot: Generated by the <code>generate_alpha_spaghettiplot_long()</code> function, this plot illustrates the temporal changes in the alpha diversity of each individual. It specifically displays Shannon diversity, a commonly used measure of species diversity, over time, with each line representing an individual in the study. Stratified by subject race, this plot provides insights into the impact of race on microbiome diversity trends over time, highlighting the complex interplay between demographic factors and microbiome dynamics.</p></figcaption></figure>

This plot, made up of lines and colors, represents the fascinating journey of our microbiome over time, influenced by various factors, including race. Stay tuned as we delve deeper into the complexities of microbiome analysis in the context of longitudinal studies!&#x20;

Embarking further on our **Chronological Journey: Alpha Diversity Analysis in Longitudinal Studies**, we now harness the power of boxplots to provide a distilled view of **alpha diversity over time**. This is achieved using the `generate_alpha_boxplot_long()` function. But, owing to the boxplot's structure, it isn't ideal for showcasing changes over a prolonged duration. Thus, to remedy this, we curate the time points exhibited via the `t0.level` and `ts.levels` parameters. Here's how:

```r
# Render a boxplot encapsulating alpha diversity across chosen time points
generate_alpha_boxplot_long(
  data.obj = subset_T2D.obj,
  alpha.obj = T2D.alpha.obj,
  alpha.name = c("shannon"),
  subject.var = "subject_id",
  time.var = "visit_number",
  t0.level = sort(unique(T2D.obj$meta.dat$visit_number))[1],
  ts.levels = sort(unique(T2D.obj$meta.dat$visit_number))[2:6],
  group.var = "subject_race",
  strata.var = NULL,
  base.size = 20,
  theme.choice = "bw",
  palette = ggsci::pal_npg()(9),
  pdf = TRUE,
  file.ann = NULL,
  pdf.wid = 20,
  pdf.hei = 8.5
)
```

<figure><img src="../.gitbook/assets/Screenshot 2023-06-13 at 21.45.06.png" alt=""><figcaption><p>Longitudinal Alpha Diversity Boxplot: Derived from the <code>generate_alpha_boxplot_long()</code> function, this plot efficiently compresses the temporal trends of Shannon diversity into a sequence of boxplots. Each box represents a distinct time point, and the spread of diversity within each time slot is succinctly portrayed. The median diversity is showcased by the line within each box, while the edges outline the first and third quartiles. This stratified depiction, segmented by subject race, enlightens us on the subtle, yet impactful influence of race on the shifts in microbiome diversity. The plot thus serves as a key that unlocks deeper understanding of the nuanced interplay between demographic variables and microbiome dynamics over time.</p></figcaption></figure>

This boxplot crystallizes the shifts in **Shannon diversity** over selected time points, displaying the **distribution of diversity** within each time point with precision. Every box signifies a time point, where the line within represents the **median diversity**, and the box's edges marking the first and third quartiles.

As we segment by **subject race**, this plot amplifies the impact of race on **microbiome diversity trends** over time. It's an exciting step in our journey, further unfurling the intriguing tapestry of the interplay between microbiome dynamics and race in longitudinal microbiome studies. Let's continue to decode these captivating complexities together!&#x20;
