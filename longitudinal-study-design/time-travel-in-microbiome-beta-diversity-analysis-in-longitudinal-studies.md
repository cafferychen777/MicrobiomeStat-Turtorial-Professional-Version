---
description: >-
  Focusing on beta diversity analysis, this page explains how to visualize and
  quantify changes in microbial community composition over time across different
  samples.
---

# Beta Diversity Analysis in Longitudinal Data with MicrobiomeStat

In the exploration of longitudinal microbiome data, understanding the **patterns and shifts in beta diversity over time** is crucial. `MicrobiomeStat` offers sophisticated and robust tools to dissect these temporal intricacies in beta diversity.

## Generate Beta Diversity Trend Test for Longitudinal Data

The function `generate_beta_trend_test_long()` conducts a comprehensive examination utilizing a **linear mixed effects model** to discern the longitudinal trend in beta diversity. It processes the distance matrix as the response, taking time as a fixed effect and subject as a random effect.

### **Usage:**
```r
data(subset_T2D.obj)
generate_beta_trend_test_long(
  data.obj = subset_T2D.obj,
  dist.obj = NULL,
  subject.var = "subject_id",
  time.var = "visit_number",
  group.var = "subject_race",
  adj.vars = c("subject_gender", "sample_body_site"),
  dist.name = c("BC", "Jaccard")
)
```

In this application, the function evaluates the **impact of time on beta diversity**, returning estimated coefficients that portray the **trends over time** and **differences between groups**.

## Generate Beta Diversity Volatility Test for Longitudinal Data

Another paramount function, `generate_beta_volatility_test_long()`, calculates a **volatility test for beta diversity** in longitudinal data, testing the relationship between beta diversity volatility and the specified group variable.

### **Usage:**
```r
data(subset_T2D.obj)
generate_beta_volatility_test_long(
  data.obj = subset_T2D.obj,
  dist.obj = NULL,
  subject.var = "subject_id",
  time.var = "visit_number_num",
  group.var = "subject_race",
  adj.vars = NULL,
  dist.name = c("BC", "Jaccard")
)
```

This function computes the **volatility of the beta diversity** for each subject and fits linear models to test the association. The output is a clear portrayal of the **associations and patterns in beta diversity volatility over time**, aiding in the profound understanding of the microbiome's temporal dynamics.

Leverage these **advanced tools by MicrobiomeStat** to delve deeper into the temporal landscape of beta diversity in your longitudinal microbiome studies. Your pathway to uncovering the **underlying patterns and shifts in microbial communities** over time is now more straightforward and insightful than ever before.

Now let's **visualize these temporal journeys using `generate_beta_pc_boxplot_long()`**. This function traces individual trajectories across ordination Axes, connecting the dots from one timepoint to the next.

```{r
generate_beta_pc_boxplot_long(
  data.obj = ecam.obj,
  dist.obj = NULL,
  pc.obj = NULL,
  subject.var = "studyid",
  time.var = "month",
  t0.level = "0",
  ts.levels = as.character(sort(as.numeric(unique(ecam.obj$meta.dat$month))))[2:4],
  group.var = "diet", 
  strata.var = "delivery",
  dist.name = c('BC'),
  base.size = 20,
  theme.choice = "bw",
  custom.theme = NULL,
  palette = NULL,
  pdf = TRUE,
  file.ann = "test",
  pdf.wid = 11,
  pdf.hei = 8.5
)
```

<figure><img src="../.gitbook/assets/Screenshot 2023-08-05 at 11.39.22.png" alt=""><figcaption><p>Generated by the <code>generate_beta_pc_boxplot_long()</code> function, this plot illustrates the temporal trajectories of beta diversity for each individual subject. It specifically displays the changes along the first two principal coordinate axes calculated from Bray-Curtis dissimilarity matrices. Each line represents an individual subject in the study, connecting their baseline microbiome position to subsequent timepoints.</p></figcaption></figure>

The resulting plot maps each subject's unique path across the ordination landscape, **telling the story of their microbiome's evolution**. By connecting the dots from one timepoint to the next, we trace out individual trajectories of change.

Now let's glimpse the big picture using `generate_beta_ordination_long()`. This paints a landscape where samples cluster based on similarity, **illuminating global patterns**.

```{r
generate_beta_ordination_long(
  data.obj = subset_T2D.obj,
  dist.obj = NULL,  
  pc.obj = NULL,
  subject.var = "subject_id",
  time.var = "visit_number",
  t0.level = sort(unique(subset_T2D.obj$meta.dat$visit_number))[1],
  ts.levels = sort(unique(subset_T2D.obj$meta.dat$visit_number))[2:4],
  group.var = "subject_race",
  strata.var = "subject_gender",
  dist.name = c("BC"),
  base.size = 16,
  theme.choice = "bw",
  custom.theme = NULL,
  palette = NULL,
  pdf = TRUE,
  file.ann = NULL,
  pdf.wid = 11,
  pdf.hei = 8.5  
)
```

<figure><img src="../.gitbook/assets/Screenshot 2023-08-05 at 11.45.10.png" alt=""><figcaption><p>Generated by the <code>generate_beta_ordination_long()</code> function, this PCoA plot illustrates the temporal trajectories of microbiome beta diversity for each individual subject. It specifically displays sample positioning along the first two ordination axes calculated from Bray-Curtis dissimilarity matrices. Each point represents one subject's microbial community at a given timepoint.</p></figcaption></figure>

The resulting ordination plot visualizes the relationships between samples, with **proximity indicating similarity**. We observe intricate patterns as samples shift across the terrain over time.

Finally, `generate_beta_change_spaghettiplot_long()` **connects the dots for each subject**, tracing individual trajectories of microbial change.

```{r
generate_beta_change_spaghettiplot_long(
  data.obj = ecam.obj,
  dist.obj = NULL,
  subject.var = "studyid",
  time.var = "month", 
  t0.level = NULL,
  ts.levels = NULL,
  group.var = "diet",
  strata.var = NULL,
  dist.name = c("BC"),
  base.size = 20,
  theme.choice = "bw",
  palette = NULL,
  pdf = TRUE,
  file.ann = "test",
  pdf.wid = 11, 
  pdf.hei = 8.5
)
```

<figure><img src="../.gitbook/assets/Screenshot 2023-08-05 at 11.48.32.png" alt=""><figcaption><p>Generated by the <code>generate_beta_change_spaghettiplot_long()</code> function, this spaghetti plot illustrates the temporal trajectories of microbiome beta diversity for each individual subject. It specifically displays changes in Bray-Curtis dissimilarity from baseline over subsequent months. Each line represents one subject's microbial community moving through time.</p></figcaption></figure>

The resulting spaghetti plot **visualizes each subject's journey through time**, elucidating the unique twists and turns of their microbial narrative.

And with that, we conclude our expedition through the dimensional shifts of beta diversity over time. From statistical tests to ordination plots, MicrobiomeStat furnished an illuminating travelogue of this intricate terrain. What an adventure!
