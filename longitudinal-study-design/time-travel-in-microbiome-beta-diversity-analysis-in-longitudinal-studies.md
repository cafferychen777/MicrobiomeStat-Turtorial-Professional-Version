---
description: >-
  Focusing on beta diversity analysis, this page explains how to visualize and
  quantify changes in microbial community composition over time across different
  samples.
---

# Time Travel in Microbiome: Beta Diversity Analysis in Longitudinal Studies

Emerging from the temporal mists, we arrive at our next destination - **illuminating shifts in beta diversity over time using `generate_beta_test_long()`**. This powerful function performs pairwise PERMANOVA tests, comparing each time point to the baseline visit. The returned p-values **quantify significant differences**, acting as guideposts to changing microbial landscapes.

Let's traverse this rugged terrain:

```{r
# Perform pairwise beta diversity tests using PERMANOVA
beta_test_long_results <- generate_beta_test_long(
  data.obj = subset_T2D.obj,
  dist.obj = NULL, 
  time.var = "visit_number",
  t0.level = sort(unique(subset_T2D.obj$meta.dat$visit_number))[1],
  ts.levels = sort(unique(subset_T2D.obj$meta.dat$visit_number))[2:6],
  subject.var = "subject_id",
  group.var = "subject_race",
  adj.vars = "subject_gender",
  dist.name = c('BC', 'Jaccard')
)
```

| Term            | D1.p.value | D2.p.value | omni.p.value |
| --------------- | ---------- | ---------- | ------------ |
| subject\_gender | 0.96       | 0.948      | 0.953        |
| subject\_race   | 0.96       | 0.948      | 0.953        |
| visit\_number   | 0.96       | 0.948      | 0.953        |

| Variable        | DF  | Sum\_Sq | Mean\_Sq | F\_Statistic | R\_Squared | P\_Value | Distance |
| --------------- | --- | ------- | -------- | ------------ | ---------- | -------- | -------- |
| subject\_gender | 2   | 1.90    | 0.952    | 2.422        | 0.007      | 0.96     | BC       |
| subject\_race   | 4   | 4.89    | 1.222    | 3.11         | 0.019      | 0.96     | BC       |
| visit\_number   | 5   | 1.39    | 0.279    | 0.709        | 0.005      | 0.96     | BC       |
| Residuals       | 630 | 248.    | 0.393    | NA           | 0.968      | NA       | BC       |
| Total           | 641 | 256.    | NA       | NA           | 1          | NA       | BC       |
| subject\_gender | 2   | 1.84    | 0.92     | 2.144        | 0.007      | 0.948    | Jaccard  |
| subject\_race   | 4   | 4.73    | 1.183    | 2.756        | 0.017      | 0.948    | Jaccard  |
| visit\_number   | 5   | 1.73    | 0.346    | 0.807        | 0.006      | 0.948    | Jaccard  |
| Residuals       | 630 | 270.    | 0.429    | NA           | 0.97       | NA       | Jaccard  |
| Total           | 641 | 279.    | NA       | NA           | 1          | NA       | Jaccard  |

The returned p-values are signposts guiding us to diverging microbial landscapes across time. **Low p-values indicate significant differences** compared to baseline, intimating dynamic change.

Now let's **visualize these temporal journeys using `generate_beta_pc_boxplot_long()`**. This function traces individual trajectories across ordination Axes, connecting the dots from one timepoint to the next.

```{r
generate_beta_pc_boxplot_long(
  data.obj = ecam.obj,
  dist.obj = NULL,
  pc.obj = NULL,
  subject.var = "studyid",
  time.var = "month",
  t0.level = "0",
  ts.levels = as.character(sort(as.numeric(unique(ecam.obj$meta.dat$month))))[2:4],
  group.var = "diet", 
  strata.var = "delivery",
  dist.name = c('BC'),
  base.size = 20,
  theme.choice = "bw",
  custom.theme = NULL,
  palette = NULL,
  pdf = TRUE,
  file.ann = "test",
  pdf.wid = 11,
  pdf.hei = 8.5
)
```

<figure><img src="../.gitbook/assets/Screenshot 2023-08-05 at 11.39.22.png" alt=""><figcaption><p>Generated by the <code>generate_beta_pc_boxplot_long()</code> function, this plot illustrates the temporal trajectories of beta diversity for each individual subject. It specifically displays the changes along the first two principal coordinate axes calculated from Bray-Curtis dissimilarity matrices. Each line represents an individual subject in the study, connecting their baseline microbiome position to subsequent timepoints.</p></figcaption></figure>

The resulting plot maps each subject's unique path across the ordination landscape, **telling the story of their microbiome's evolution**. By connecting the dots from one timepoint to the next, we trace out individual trajectories of change.

Now let's glimpse the big picture using `generate_beta_ordination_long()`. This paints a landscape where samples cluster based on similarity, **illuminating global patterns**.

```{r
generate_beta_ordination_long(
  data.obj = subset_T2D.obj,
  dist.obj = NULL,  
  pc.obj = NULL,
  subject.var = "subject_id",
  time.var = "visit_number",
  t0.level = sort(unique(subset_T2D.obj$meta.dat$visit_number))[1],
  ts.levels = sort(unique(subset_T2D.obj$meta.dat$visit_number))[2:4],
  group.var = "subject_race",
  strata.var = "subject_gender",
  dist.name = c("BC"),
  base.size = 16,
  theme.choice = "bw",
  custom.theme = NULL,
  palette = NULL,
  pdf = TRUE,
  file.ann = NULL,
  pdf.wid = 11,
  pdf.hei = 8.5  
)
```

<figure><img src="../.gitbook/assets/Screenshot 2023-08-05 at 11.45.10.png" alt=""><figcaption><p>Generated by the <code>generate_beta_ordination_long()</code> function, this PCoA plot illustrates the temporal trajectories of microbiome beta diversity for each individual subject. It specifically displays sample positioning along the first two ordination axes calculated from Bray-Curtis dissimilarity matrices. Each point represents one subject's microbial community at a given timepoint.</p></figcaption></figure>

The resulting ordination plot visualizes the relationships between samples, with **proximity indicating similarity**. We observe intricate patterns as samples shift across the terrain over time.

Finally, `generate_beta_change_spaghettiplot_long()` **connects the dots for each subject**, tracing individual trajectories of microbial change.

```{r
generate_beta_change_spaghettiplot_long(
  data.obj = ecam.obj,
  dist.obj = NULL,
  subject.var = "studyid",
  time.var = "month", 
  t0.level = NULL,
  ts.levels = NULL,
  group.var = "diet",
  strata.var = NULL,
  dist.name = c("BC"),
  base.size = 20,
  theme.choice = "bw",
  palette = NULL,
  pdf = TRUE,
  file.ann = "test",
  pdf.wid = 11, 
  pdf.hei = 8.5
)
```

<figure><img src="../.gitbook/assets/Screenshot 2023-08-05 at 11.48.32.png" alt=""><figcaption><p>Generated by the <code>generate_beta_change_spaghettiplot_long()</code> function, this spaghetti plot illustrates the temporal trajectories of microbiome beta diversity for each individual subject. It specifically displays changes in Bray-Curtis dissimilarity from baseline over subsequent months. Each line represents one subject's microbial community moving through time.</p></figcaption></figure>

The resulting spaghetti plot **visualizes each subject's journey through time**, elucidating the unique twists and turns of their microbial narrative.

And with that, we conclude our expedition through the dimensional shifts of beta diversity over time. From statistical tests to ordination plots, MicrobiomeStat furnished an illuminating travelogue of this intricate terrain. What an adventure!
