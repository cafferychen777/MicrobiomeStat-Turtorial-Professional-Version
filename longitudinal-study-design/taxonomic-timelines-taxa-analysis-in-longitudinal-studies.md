---
description: >-
  This page guides you through the process of investigating how taxonomic
  composition changes within a longitudinal context, providing insights into
  microbial dynamics over time.
---

# Taxonomic Timelines: Taxa Analysis in Longitudinal Studies

**Delving into the depths of longitudinal microbiome data requires a robust toolkit. Fortunately, MicrobiomeStat arms us with a set of powerful functions to illuminate the intricate taxonomic changes over time.**

**Analyzing taxonomic changes in longitudinal microbiome studies reaches its pinnacle with the `generate_taxa_test_long()` function. Let's explore this powerful tool for differential abundance testing between groups and timepoints before delving into other visualizations.**

```R
generate_taxa_test_long(
  data.obj = ecam.obj,
  subject.var = "studyid",
  time.var = "month",
  t0.level = NULL,
  ts.levels = NULL,
  group.var = "diet",
  adj.vars = "antiexposedall",
  feature.level = "Phylum",
  prev.filter = 0.001,
  abund.filter = 0.001,
  feature.dat.type = "proportion"
)
```

**This function returns a detailed results table of longitudinal differential abundance analysis, exposing significant taxonomic differences between groups over time. Armed with these results, we can now embark on a comprehensive exploration of the microbiome dynamics using an array of other MicrobiomeStat functions.**

| Phylum              | Variable | Group     | Base.Mean    | Log2.Fold.Change | LFC.SE       | Stat         | P.Value      | Adjusted.P.Value | Mean.Abundance | Mean.Prevalence | Output.Element |
| ------------------- | -------- | --------- | ------------ | ---------------- | ------------ | ------------ | ------------ | ---------------- | -------------- | --------------- | -------------- |
| p\_\_Actinobacteria | bd       | 17915.206 | -0.027940742 | 0.2988761        | -0.093486035 | 9.255558e-01 | 9.939802e-01 | 0.150289817      | 1              | antiexposedally |                |
| p\_\_Actinobacteria | fd       | 17915.206 | -0.027940742 | 0.2988761        | -0.093486035 | 9.255558e-01 | 9.939802e-01 | 0.104519584      | 1              | antiexposedally |                |
| p\_\_Bacteroidetes  | bd       | 45447.461 | 0.090221391  | 0.3533415        | 0.255337674  | 7.985264e-01 | 9.939802e-01 | 0.253147914      | 1              | antiexposedally |                |
| p\_\_Bacteroidetes  | fd       | 45447.461 | 0.090221391  | 0.3533415        | 0.255337674  | 7.985264e-01 | 9.939802e-01 | 0.255437214      | 1              | antiexposedally |                |

Next, let's explore `generate_taxa_areaplot_long()` to visualize the abundance trajectories of specific taxa across multiple timepoints:

```R
generate_taxa_areaplot_long(
  data.obj = ecam.obj,
  subject.var = "studyid", 
  time.var = "month",
  group.var = "diet",
  strata.var = "antiexposedall",
  feature.level = "Family",
  feature.dat.type = "proportion",  
  feature.number = 8,
  t0.level = unique(ecam.obj$meta.dat$month)[1],
  ts.levels = unique(ecam.obj$meta.dat$month)[-1],
  base.size = 10,
  theme.choice = "bw",
  palette = NULL,
  pdf = TRUE,
  file.ann = "test"
)
```

<figure><img src="../.gitbook/assets/Screenshot 2023-08-05 at 14.28.37.png" alt=""><figcaption><p>Longitudinal Area Plot of Specific Taxa: Generated by the <code>generate_taxa_areaplot_long()</code> function, this longitudinal plot visualizes the abundance trajectories of the top 8 most abundant families across time. Each area represents a taxon, enabling comparison of abundance changes between groups stratified by antiexposedall. Tracking these trajectories provides insight into the temporal waxing and waning of microbial populations. This aids in elucidating the intricate dynamics of taxa over time.</p></figcaption></figure>

**This longitudinal area plot allows us to track the waxing and waning of specific taxa over time, comparing trajectories between groups. The `feature.number` parameter focuses the plot on the top 8 most abundant families, providing a clear snapshot of the shifting microbial landscape.**

Moving on, let's explore `generate_taxa_barplot_long()` to gain insights into the taxonomic composition within groups at each timepoint:

```R
generate_taxa_barplot_long(
  data.obj = ecam.obj,
  subject.var = "studyid",
  time.var = "month", 
  group.var = "delivery",
  strata.var = "diet",
  feature.level = "Family",
  feature.dat.type = "proportion",
  feature.number = 10, 
  t0.level = NULL,
  ts.levels = NULL,
  theme.choice = "bw",
  palette = NULL,
  pdf = TRUE,
  file.ann = "test" 
)
```

<figure><img src="../.gitbook/assets/Screenshot 2023-08-05 at 14.33.16.png" alt=""><figcaption><p>Longitudinal Stacked Bar Plot of Taxonomic Composition: This bar plot visualizes the longitudinal changes in microbiome composition at the family level within groups stratified by delivery mode. Generated using the <code>generate_taxa_barplot_long()</code> function, the stacked bars showcase the taxonomic shift over time. Limiting to the top 10 most abundant families maintains clarity. The plot provides an intuitive snapshot of community dynamics.</p></figcaption></figure>

**The stacked bars provide an intuitive snapshot of how the microbial community shifts over time, with a focus on the top 10 families for clarity.**

Continuing our journey, `generate_taxa_boxplot_long()` offers an in-depth look at the distribution of specific phyla over time:

```R
generate_taxa_boxplot_long(
  data.obj = ecam.obj,
  subject.var = "studyid",
  time.var = "month",
  t0.level = NULL,
  ts.levels = NULL,  
  group.var = "diet",
  strata.var = NULL,
  feature.level = c("Phylum"),
  features.plot = sample(unique(ecam.obj$feature.ann[,"Phylum"]),1),
  feature.dat.type = "proportion",
  Transform = "log",
  prev.filter = 0,
  abund.filter = 0,
  base.size = 12,
  theme.choice = "bw",
  custom.theme = NULL,
  palette = NULL,
  pdf = TRUE,  
  file.ann = "test",
  pdf.wid = 11,
  pdf.hei = 8.5
)
```

<figure><img src="../.gitbook/assets/Screenshot 2023-08-05 at 14.35.57.png" alt=""><figcaption><p>Longitudinal Distribution of Phylum Abundance: This longitudinal boxplot visualizes the distribution of abundance over time for a specific phylum of interest. Generated via <code>generate_taxa_boxplot_long()</code>, it displays changes in central tendency and dispersion. Log transformation and filtering enable focused insights. The plot enables in-depth analysis of phylum-level abundance shifts across the timeline.</p></figcaption></figure>

**This visualization enables us to assess changes in central tendency and dispersion, with the ability to focus on phyla of interest using the `features.plot` parameter.**

To uncover intricate abundance change patterns, we can generate an insightful heatmap with `generate_taxa_change_heatmap_long()`:

```R
generate_taxa_change_heatmap_long(
  data.obj = ecam.obj,
  subject.var = "studyid",
  time.var = "month_num",
  t0.level = NULL,
  ts.levels = NULL,  
  group.var = "antiexposedall",
  strata.var = "diet",
  feature.level = c("Family"),
  feature.dat.type = "proportion",
  features.plot = NULL,
  top.k.plot = 10,
  top.k.func = "sd",
  change.func = "lfc",
  palette = NULL,
  prev.filter = 0.01,
  abund.filter = 0.01,
  pdf = TRUE,
  file.ann = NULL  
)
```

<figure><img src="../.gitbook/assets/Screenshot 2023-08-05 at 14.37.55.png" alt=""><figcaption><p>Longitudinal Family Abundance Change Heatmap: This heatmap visualizes longitudinal changes in family abundance using log2 fold change. Generated via <code>generate_taxa_change_heatmap_long()</code>, it focuses on the top 10 most dynamic families. The color intensity reflects the magnitude of change over time. It provides insights into meaningful abundance shifts and relationships between specific families.</p></figcaption></figure>

**By spotlighting log2 fold changes, this heatmap accentuates meaningful shifts in family abundance over time, focusing on the top 10 families with the highest standard deviation.**

Next, let's construct a comprehensive heatmap of taxonomic composition with `generate_taxa_heatmap_long()`:

```R
generate_taxa_heatmap_long(
  data.obj = ecam.obj,
  subject.var = "studyid",
  time.var = "month_num",
  t0.level = NULL,
  ts.levels = NULL,
  group.var = "delivery",
  strata.var = "diet",
  feature.level = "Family",
  feature.dat.type = "proportion",
  features.plot = NULL,
  top.k.plot = NULL,
  top.k.func = NULL,
  prev.filter = 0.01,
  abund.filter = 0.01,
  pdf = TRUE,
  file.ann = NULL,
  pdf.wid = 11,
  pdf.hei = 8.5
)
```

<figure><img src="../.gitbook/assets/Screenshot 2023-08-05 at 14.41.20.png" alt=""><figcaption><p>Longitudinal Microbiome Composition Heatmap: This heatmap visualizes the longitudinal taxonomic composition at the family level. Generated via <code>generate_taxa_heatmap_long()</code>, color intensity represents abundance. It provides an intuitive overview of community dynamics over time, stratified by delivery mode and diet. Filtering focuses the analysis on relevant families. The plot enables visualization of temporal abundance patterns.</p></figcaption></figure>

**This heatmap provides an inviting visual overview of microbiome composition over time, with abundance represented by color intensity. Filtering focuses the heatmap on meaningful families.**

Continuing with taxon-specific trajectories, `generate_taxa_indiv_boxplot_long()` constructs detailed individual boxplots:

```R
generate_taxa_indiv_boxplot_long(
  data.obj = ecam.obj,
  subject.var = "studyid",
  time.var = "month",
  t0.level = NULL,
  ts.levels = NULL,
  group.var = NULL,  
  strata.var = NULL,
  feature.level = c("Phylum"),
  feature.dat.type = "proportion",
  Transform = "log",
  prev.filter = 0.01,
  abund.filter = 0.01,
  base.size = 20,
  theme.choice = "bw",
  custom.theme = NULL,
  palette = c("#1f77b4", "#ff7f0e", "#2ca02c", "#d62728", "#9467bd",  
  "#8c564b", "#e377c2", "#7f7f7f", "#bcbd22", "#17becf", "#aec7e8",
  "#ffbb78", "#98df8a", "#ff9896", "#c5b0d5", "#c49c94", "#f7b6d2",
  "#

c7c7c7", "#dbdb8d", "#9edae5", "#f0f0f0", "#3182bd"),
  pdf = TRUE,
  file.ann = NULL,
  pdf.wid = 11,
  pdf.hei = 8.5
)
```

<figure><img src="../.gitbook/assets/image.png" alt=""><figcaption><p>Longitudinal Phylum Abundance Boxplots: This function generates individual boxplots showing the distribution of specific phyla abundance over time. Transformations and filtering enable focused insights. The customized color palette enhances visualization. These plots allow in-depth analysis of abundance changes for each phylum longitudinally.</p></figcaption></figure>

**These individual boxplots provide focused insights into each phylum's abundance changes over time, with customized color schemes for enhanced visualization.**

For spaghetti plots showcasing individual trajectories, `generate_taxa_indiv_spaghettiplot_long()` connects the dots:

```R
generate_taxa_indiv_spaghettiplot_long(
  data.obj = ecam.obj,
  subject.var = "studyid",
  time.var = "month_num", 
  t0.level = NULL,
  ts.levels = NULL,
  group.var = "diet",
  strata.var = "antiexposedall",
  feature.level = c("Phylum"),
  features.plot = NULL,
  feature.dat.type = "proportion",
  top.k.plot = 5,
  top.k.func = "mean",
  prev.filter = 0.01,
  abund.filter = 0.01,
  base.size = 16,
  theme.choice = "bw",  
  palette = NULL,
  pdf = TRUE,
  file.ann = NULL
)
```

**These individual spaghetti plots trace each subject's journey over time for specific phyla. The top 5 phyla by mean abundance are displayed for clarity.**

To assess group changes, `generate_taxa_spaghettiplot_long()` creates stacked spaghetti plots:

```R
generate_taxa_spaghettiplot_long(
  data.obj = ecam.obj,
  subject.var = "studyid",
  time.var = "month_num",
  t0.level = NULL,
  ts.levels = NULL,
  group.var = "diet",
  strata.var = "antiexposedall",
  feature.level = c("Phylum"),
  features.plot = NULL,
  feature.dat.type = "proportion",
  top.k.plot = 3,
  top.k.func = "mean",
  prev.filter = 0,
  abund.filter = 0,
  base.size = 16,
  theme.choice = "bw",
  palette = NULL,
  pdf = TRUE,
  file.ann = NULL  
)
```

**These stacked spaghetti plots overlay individual trajectories to highlight group changes in phyla abundance over time. The top 3 phyla by mean abundance are displayed for a focused analysis.**

With these powerful tools at our disposal, we can now uncover intricate taxonomic changes and gain deeper insights into the dynamics of the microbiome in longitudinal studies. Let's proceed with the MicrobiomeStat functions to unravel the mysteries within the data.
